name: Deploy Company Website
 
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to Server
        uses: appleboy/ssh-action@v0.1.5
        with:
          host: 72.60.27.165
          username: dev
          key: ${{ secrets.SERVER_SSH_KEY }}
          port: 22
          script: |
            echo "Deploying Company Website..."
            cd /opt/stack/apps/company-website


            # Clone or update
            if [ ! -d "src/.git" ]; then
              git clone https://github.com/DataTranquil/comapny-website.git src
            else
              cd src && git pull origin main && cd ..
            fi

            # Build and deploy
            docker compose build
            docker compose up -d

            echo "Company Website deployed!"
